<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Add Session Form</title>

  <link href="{{ url_for('static', path='/css/helper_add/common_form.css') }}" rel="stylesheet">

</head>
<body>
  <div class="form-container">

    <div id="header"> 
      <h1>Add Session Form</h1>
    </div>

    <form id="sessionForm" action="/helper/add_session" method="POST" enctype="multipart/form-data">

      <section>
        <h3>Session Information</h3>

        <!-- First Row -->
        <div id="first-row">
          <div class="form-row">
            <label>Session:</label>
            <input type="text" name="session_name" placeholder="2026">
          </div>
      </section>

      <div class="submit-container">
        <button type="submit">Submit</button>
        <button type="button" onclick="window.location.href='/main/list_form'">Close</button>
      </div>
    </form>
  </div>

  <script>

        // Form validation
        document.getElementById("sessionForm").addEventListener("submit", function (e) {
            e.preventDefault(); // Stop standard submission to validate first
            clearValidation();

            let isValid = true;

            // 1. Validate Session Name, should be number and not empty
            const sessionInput = document.querySelector("input[name='session_name']");
            if (sessionInput.value.trim() === "") {
                showFieldError(sessionInput, "Session Name is required");
                isValid = false;
            }
            if (isNaN(sessionInput.value.trim())) {
                showFieldError(sessionInput, "Session Name must be a number");
                isValid = false;
            }
            // the session should be of four digit number and should start with 20
            if (sessionInput.value.trim().length !== 4 || !sessionInput.value.trim().startsWith("20")) {
                showFieldError(sessionInput, "Session Name must be a 4-digit number starting with '20'");
                isValid = false;
            }

            // 3. If everything is valid, submit the form
            if (isValid) {
                this.submit();
            }
        });

        // ==========================================
        //  HELPER FUNCTIONS
        // ==========================================
        function showFieldError(el, message) {
            el.classList.add("input-error");
            showError(el, message);
        }

        function showError(el, msg) {
            if (el.nextElementSibling?.classList.contains("error-message")) return;
            const d = document.createElement("div");
            d.className = "error-message";
            d.innerText = msg;
            d.style.color = "red";
            d.style.fontSize = "12px";
            el.insertAdjacentElement("afterend", d);
        }

        function clearValidation() {
            document.querySelectorAll(".input-error").forEach(el => el.classList.remove("input-error"));
            document.querySelectorAll(".error-message").forEach(e => e.remove());
        }

  </script>
</body>
</html>
